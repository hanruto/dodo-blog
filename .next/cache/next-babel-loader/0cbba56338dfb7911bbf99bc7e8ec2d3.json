{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState, useRef } from 'react';\nimport Link from 'next/link';\nimport dayjs from 'dayjs';\nimport { connect } from 'react-redux';\nimport Logo from \"../../components/Logo\";\nimport AnimateQueue from \"../../components/AnimateQueue\";\nimport ScrollDetect from \"../../components/ScrollDetect\";\nimport LoadingText from \"../../components/LoadingText\";\nimport store from \"../../store\";\nimport \"./index.scss\";\nvar PAGE_SIZE = 15;\n\nvar sortBlog = function sortBlog(blogArr) {\n  var list = [];\n  var currentGroupCreated = '';\n  blogArr.forEach(function (item) {\n    var created = dayjs(item.created).format('YYYY / MM');\n\n    if (created !== currentGroupCreated) {\n      currentGroupCreated = created;\n      list.push({\n        title: created,\n        type: 'date',\n        id: created\n      });\n    }\n\n    list.push({\n      title: item.title,\n      type: 'blog',\n      id: item._id\n    });\n  });\n  return list;\n};\n\nvar BlogItem = function BlogItem(props) {\n  var blog = props.info,\n      style = props.style;\n  return blog.type === 'date' ? __jsx(\"div\", {\n    className: \"blog-date\",\n    style: style\n  }, blog.title) : __jsx(\"div\", {\n    className: \"blog-item\",\n    style: style\n  }, __jsx(Link, {\n    href: \"/blog?id=\".concat(blog.id)\n  }, __jsx(\"a\", {\n    className: \"page-common-blog-title\"\n  }, blog.title)));\n};\n\nfunction BlogListPage(props) {\n  var initBlogList = props.initBlogList,\n      blogList = props.blogList,\n      getBlogList = props.getBlogList,\n      renderedBlogListNumber = props.renderedBlogListNumber,\n      setRenderedBlogListNumber = props.setRenderedBlogListNumber;\n\n  var _useState = useState(renderedBlogListNumber || PAGE_SIZE),\n      showNum = _useState[0],\n      setShowNum = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var showNumRef = useRef(0);\n  useEffect(function () {\n    !initBlogList && getBlogList();\n    return function () {\n      return setRenderedBlogListNumber(showNumRef.current);\n    };\n  }, []);\n  var list = sortBlog((initBlogList || blogList).list);\n  var isLoadAll = list.length && showNum >= list.length;\n\n  var handleLoadMore = function handleLoadMore() {\n    if (isLoadAll) return;\n    var currentShowNum = showNum + PAGE_SIZE;\n    showNumRef.current = currentShowNum;\n    setShowNum(currentShowNum);\n    setLoading(true);\n  };\n\n  var handleAnimateEnd = function handleAnimateEnd() {\n    setLoading(false);\n  };\n\n  return __jsx(\"div\", {\n    className: \"blog-list-page page-common-container\"\n  }, __jsx(Logo, null), __jsx(ScrollDetect, {\n    onScrollOut: handleLoadMore,\n    protectTime: 500\n  }, list.slice(0, renderedBlogListNumber).map(function (item) {\n    return __jsx(BlogItem, {\n      key: item.id,\n      info: item\n    });\n  }), __jsx(AnimateQueue, {\n    animate: true,\n    interval: 100,\n    from: {\n      transform: 'translateX(100px)',\n      opacity: 0\n    },\n    to: {\n      transform: 'translateX(0px)',\n      opacity: 1\n    },\n    onAnimateEnd: handleAnimateEnd\n  }, list.slice(renderedBlogListNumber, showNum).map(function (item) {\n    return __jsx(BlogItem, {\n      key: item.id,\n      info: item\n    });\n  })), __jsx(\"div\", {\n    className: \"blog-list-info\"\n  }, isLoadAll ? '已全部加载' : loading && __jsx(LoadingText, null))));\n}\n\nBlogListPage.getInitialProps = function _callee() {\n  var getBlogList, initBlogList;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          getBlogList = store.dispatch.blogModel.getBlogList;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(getBlogList());\n\n        case 3:\n          initBlogList = _context.sent;\n          return _context.abrupt(\"return\", {\n            initBlogList: initBlogList\n          });\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n};\n\nvar mapState = function mapState(state) {\n  return _objectSpread({}, state.blogModel, {}, state.globalModel);\n};\n\nvar mapDispatch = function mapDispatch(state) {\n  return _objectSpread({}, state.blogModel, {}, state.globalModel);\n};\n\nexport default connect(mapState, mapDispatch)(BlogListPage);","map":{"version":3,"sources":["/Users/qm/project/dodo-blog-v2/pages/index/index.tsx"],"names":["React","useEffect","useState","useRef","Link","dayjs","connect","Logo","AnimateQueue","ScrollDetect","LoadingText","store","PAGE_SIZE","sortBlog","blogArr","list","currentGroupCreated","forEach","item","created","format","push","title","type","id","_id","BlogItem","props","blog","info","style","BlogListPage","initBlogList","blogList","getBlogList","renderedBlogListNumber","setRenderedBlogListNumber","showNum","setShowNum","loading","setLoading","showNumRef","current","isLoadAll","length","handleLoadMore","currentShowNum","handleAnimateEnd","slice","map","transform","opacity","getInitialProps","dispatch","blogModel","mapState","state","globalModel","mapDispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react'\nimport Link from 'next/link'\nimport dayjs from 'dayjs'\nimport { connect } from 'react-redux'\nimport Logo from '../../components/Logo'\nimport AnimateQueue from '../../components/AnimateQueue'\nimport ScrollDetect from '../../components/ScrollDetect'\nimport LoadingText from '../../components/LoadingText'\nimport store from '../../store'\nimport './index.scss'\n\nconst PAGE_SIZE = 15\n\ntype BlogItemType = { type: 'date' | 'blog'; title: string; id: string }\n\nconst sortBlog = (blogArr: { created: Date; title: string; _id: string }[]) => {\n  const list: BlogItemType[] = []\n\n  let currentGroupCreated = ''\n\n  blogArr.forEach(item => {\n    const created = dayjs(item.created).format('YYYY / MM')\n\n    if (created !== currentGroupCreated) {\n      currentGroupCreated = created\n      list.push({ title: created, type: 'date', id: created })\n    }\n\n    list.push({ title: item.title, type: 'blog', id: item._id })\n  })\n\n  return list\n}\n\nconst BlogItem = (props: {\n  info: BlogItemType\n  style?: React.CSSProperties\n}) => {\n  const { info: blog, style } = props\n\n  return blog.type === 'date' ? (\n    <div className=\"blog-date\" style={style}>\n      {blog.title}\n    </div>\n  ) : (\n    <div className=\"blog-item\" style={style}>\n      <Link href={`/blog?id=${blog.id}`}>\n        <a className=\"page-common-blog-title\">{blog.title}</a>\n      </Link>\n    </div>\n  )\n}\n\nfunction BlogListPage(props) {\n  const {\n    initBlogList,\n    blogList,\n    getBlogList,\n    renderedBlogListNumber,\n    setRenderedBlogListNumber,\n  } = props\n\n  const [showNum, setShowNum] = useState(renderedBlogListNumber || PAGE_SIZE)\n  const [loading, setLoading] = useState(false)\n  const showNumRef = useRef(0)\n\n  useEffect(() => {\n    !initBlogList && getBlogList()\n\n    return () => setRenderedBlogListNumber(showNumRef.current)\n  }, [])\n\n  const list = sortBlog((initBlogList || blogList).list)\n  const isLoadAll = list.length && showNum >= list.length\n\n  const handleLoadMore = () => {\n    if (isLoadAll) return\n\n    const currentShowNum = showNum + PAGE_SIZE\n    showNumRef.current = currentShowNum\n\n    setShowNum(currentShowNum)\n    setLoading(true)\n  }\n\n  const handleAnimateEnd = () => {\n    setLoading(false)\n  }\n\n  return (\n    <div className=\"blog-list-page page-common-container\">\n      <Logo />\n\n      <ScrollDetect onScrollOut={handleLoadMore} protectTime={500}>\n        {list.slice(0, renderedBlogListNumber).map(item => {\n          return <BlogItem key={item.id} info={item} />\n        })}\n\n        <AnimateQueue\n          animate={true}\n          interval={100}\n          from={{ transform: 'translateX(100px)', opacity: 0 }}\n          to={{ transform: 'translateX(0px)', opacity: 1 }}\n          onAnimateEnd={handleAnimateEnd}\n        >\n          {list.slice(renderedBlogListNumber, showNum).map(item => {\n            return <BlogItem key={item.id} info={item} />\n          })}\n        </AnimateQueue>\n\n        <div className=\"blog-list-info\">\n          {isLoadAll ? '已全部加载' : loading && <LoadingText />}\n        </div>\n      </ScrollDetect>\n    </div>\n  )\n}\n\nBlogListPage.getInitialProps = async () => {\n  const { getBlogList } = store.dispatch.blogModel\n  const initBlogList = await getBlogList()\n\n  return { initBlogList }\n}\n\nconst mapState = state => ({ ...state.blogModel, ...state.globalModel })\n\nconst mapDispatch = state => ({ ...state.blogModel, ...state.globalModel })\n\nexport default connect(mapState, mapDispatch)(BlogListPage)\n"]},"metadata":{},"sourceType":"module"}